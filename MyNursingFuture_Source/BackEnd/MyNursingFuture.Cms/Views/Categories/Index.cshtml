
@{
    ViewBag.Title = "Categories";
    var list = ViewBag.Categories;
}

<h2>Categories</h2>

@CustomHelpers.SuccessMessage(TempData)
<br />
<div class="row">
    <div class="col-lg-12">
        @Html.ActionLink("Go Back", "Index", "Home", null, new { @class = "btn pull-left" })
        <button class="btn pull-right" onclick="$('#category-modal-insert').modal('show')">New Category</button>
    </div>
</div>
<br />
<div class="row text-center">
    <div class="col-sm-4">
        Name
    </div>
</div>

@foreach (var item in list)
{
    <div class="row row-table text-center">
        <div class="col-sm-4">@item.Name</div>
        <div class="col-sm-4">
            <button class="btn pull-right" onclick="editCategory(@item.CategoryId,'@item.Name')">Edit</button>
        </div>
        <div class="col-sm-4">
            <button class="btn delete-btn pull-right" onclick="confirmDelete(@item.CategoryId)">X</button>
        </div>
    </div>
}


@using (Html.BeginForm("Delete", "Categories", FormMethod.Post, new { id = "form-delete" }))
{
    @Html.AntiForgeryToken()
    <input type="hidden" value="" id="delete-id" name="id" />
}
<script>
    function confirmDelete(id) {
        $("#delete-id").val(id);
        $("#confirm-delete").modal('show');
    }

    function editCategory(id, name) {
        $("#category-id").val(id);
        $("#category-edit-name").val(name);
        $("#category-modal-edit").modal('show');
    }
    function saveInsert() {
        $("#error-message").hide();
        var val = $("#category-insert-name").val();
        if (val == "") {
            $("#name-error-insert").show();
            return;
        }
        $("#form-insert").submit();
    }

    function saveEdit() {
        $("#error-message").hide();
        var val = $("#category-edit-name").val();
        if (val == "") {
            $("#name-error-edit").show();
            return;
        }
        $("#form-edit").submit();
    }
</script>

<div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Delete Category
            </div>
            <div class="modal-body">
                Are you sure that you want to delete this category?
            </div>
            <div class="modal-footer">
                <button class="btn delete-btn" onclick="$('#form-delete').submit()">Delete</button>
                <button type="button" class="btn" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="category-modal-insert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Add new category
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("Insert", "Categories", FormMethod.Post, new { id = "form-insert" }))
                {
                    @Html.AntiForgeryToken()
                    <div class="row">
                        <div class="col-xs-12 form-group">
                            <label>Name:</label><span class="error-message" style="display:none" id="name-error-insert">*Name is required</span>
                            <input type="text" class="form-control" name="name" id="category-insert-name" />
                        </div>
                    </div>
                }
                <div class="row">
                    <div class="col-xs-12">
                        <button class="btn" onclick="saveInsert()">Save</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn delete-btn" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="category-modal-edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Modify category
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("Edit", "Categories", FormMethod.Post, new { id = "form-edit" }))
                {
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="category-id" name="id" />
                    <div class="row">
                        <div class="col-xs-12 form-group">
                            <label>Name:</label>
                            <input type="text" class="form-control" name="name" id="category-edit-name" />
                        </div>
                    </div>
                }
                <div class="row">
                    <div class="col-xs-12">
                        <button class="btn" onclick="saveEdit()">Save</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn delete-btn" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>