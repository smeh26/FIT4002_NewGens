# Report Generator

This thing uses `wkhtmltopdf` (https://wkhtmltopdf.org/) to generate a pdf from a html page generated from json sent from the application!
This is not called directly, the .NET backend proxies calls to it.

- express.js
- pug templates
- using 'forever' on production server to keep it running if it stops/crashes.

-- using 'nssm' on production server to both monitor and start node for report generator on machine reboot, instead of 'forever' which had issues on restart
https://aigeec.com/starting-node-as-a-service-with-nssm/
nssm install pdf-generator "C:\Program Files\nodejs\node.exe"
nssm set pdf-generator AppDirectory "C:\pdf-generator"
nssm set pdf-generator AppParameters "generate.js"
nssm set pdf-generator AppStdout "C:\pdf-generator\logs\out.log"
nssm set pdf-generator AppStderr "C:\pdf-generator\logs\out.log"
nssm set pdf-generator AppEnvironmentExtra "PORT=8081"
nssm start pdf-generator

## Running locally

- `npm install`
- `node ./generate.js`

Then send requests to `http://localhost:8081/sareport`

**add `"raw": true` to the json for the endpoint to return the html without using wkhtmltopdf, useful for debugging and saving as html to fiddle with styles etc**

prod endpoint is `https://mynursingfuture.com.au/app/api/report`

`test-data.json` contains an example request. It is generated by the application: `selfAssessmentResultsToReportJSON` in `apna-react-fe/src/Actions/index.js`

## Develop locally

- setup `application in IIS` point to self-assessment-report-generator folder
- change `config.js` baseUrl to point to the new application (previous step)
- use `test-report-one.html` for report-rn to develop and preview changes